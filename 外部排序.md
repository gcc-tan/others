外部排序（External sorting）是指能够处理大量数据的排序算法。通常来说，外排序处理的数据不能够一次装入内存，只能放在读写较慢的外部存储器上（硬盘）。外排序采取的是一种排序-归并的策略。在排序阶段，先读入能够放在内存中的数据量，将其排序输出到一个临时文件，依此进行，将待排序数据组织为多个有序的临时文件。最后归并阶段将这些临时文件组合为一个大的有序文件，即排序结果。


###例子

假设要对900MB的数据进行排序，但机器上只有100MB的可用内存时，按照下面方式对900MB的数据进行排序：

1. 读入100MB的数据至内存中，用常规的内排序算法（快速排序，堆排序等），在内存中完成排序
2. 将排序结果写入磁盘
3. 重复步骤1和2，直到所有的数据都存入了不同的100MB的临时文件中。所以这时临时文件有9个。
4. 读取每个临时文件（顺串）的前10MB的数据放入内存的输入缓冲区，最后的10MB作为输出缓冲区。（实践中，将输入缓冲适当调小，适当增大输出缓冲区能够获得更好的效果）
5. 执行九路归并算法，将结果输出到输出缓冲区。一旦输出缓冲区满，将缓冲区的数据写出至目标文件，清空缓冲区。一旦9个输入缓冲区的一个变空，就从这个缓冲区关联的文件，读入下一个10M数据，除非这个文件已经读完。


其实总的来说是外部存储器的速度是影响算法执行速度的关键因素。所以只要减少外存的访问次数和读写的数据量，就能提高算法速度。

+ 归并的路数选择
+ 增大顺序文件的长度

上述例子的外排序有两个步骤：排序和归并。我们用一次多路归并就完成了所有临时文件的归并，而并非按内存中的二路归并那样，一次归并两个子串，耗费 $log_2n$次归并。外排序中不适用上述方法的原因在于每次读写都需要对硬盘进行读写，而这是非常缓慢的。所以应该尽可能减小磁盘的读写次数。

不过，在上述方法中也存在权衡。当临时文件（顺串）的数量继续增大时，归并时每次可从顺串中读入的数据减少了。比如说，50 GB的数据量，100 MB的可用内存，这种情况下用一趟多路归并就显得不划算。读入很多的顺串花费的时间占据了排序时间的大部分。这时，我们可以用多次（比如两次）归并来解决这个问题。

###置换选择排序（Replacement selection sorting）

假设内存的大小为M，这个算法能够产生大于或者等于M的有序临时文件。假设无法加载进入内存的文件为A，置换选择排序算法描述如下：

1. 从文件A中读取长度为M（为留下输出缓冲区，一般会小于M，输入也会有缓冲）的数据进入内存，建立最小堆
2. 将堆顶元素输出，然后读取A中的下一个元素：
    a. 如果元素的值不小于刚刚输出的元素的值，那么将其作为堆顶并调整堆，使之满足堆的性质。
    b. 否则将新元素放入堆底位置，将堆大小减1
3. 重复2,直至堆的大小变为0.
4. 此时一个顺串已经产生。内存中的剩下元素建堆，开始生成下一个顺串。

这个方法能够生成平均长度为2M的顺串。可以进一步减少访问外部存储器的次数，节约时间，提高算法效率。因为比当前最小堆的堆顶小的元素不属于当前的顺串，但是可以放在下次比较中判断是否属于下个顺串。












内容来自

[外排序](https://zh.wikipedia.org/wiki/%E5%A4%96%E6%8E%92%E5%BA%8F)